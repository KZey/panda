<script type="text/javascript" charset="utf-8">
	intv = setInterval(function() {
		$.get("/status/<%= @video['id'] %>.json", {}, function(res, testStatus) {
			encoding = res[0];
			$('#status').html(encoding['status']);
			$('#bar').css('width', encoding['encoding_progress']+'%')
			
			if(encoding['status'] == 'success') {
  			$('#bar').css('width', '100%')
  			
				$('#video').html('<embed src="http://s3.amazonaws.com/panda-test-videos/player.swf" width="'+encoding['width']+'" height="'+encoding['height']+'" allowfullscreen="true" allowscriptaccess="always" flashvars="&displayheight='+encoding['height']+'&file=http://s3.amazonaws.com/panda-test-videos/'+encoding['id']+encoding['extname']+'&width='+encoding['width']+'&height='+encoding['height']+'" />');
  			$('#status').html('http://s3.amazonaws.com/panda-test-videos/'+encoding['id']+encoding['extname']);
				clearInterval(intv);
			}
		}, 'json');
	}, 1000);
</script>

<h2>Uploaded "<%= @video['original_filename'] %>"</h2>

<div id="status">Getting status...</div>
<div id="progress"><div id="bar"></div></div>
<div id="video"></div>